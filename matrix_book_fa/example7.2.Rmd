---
title: "مثال ۷-۲: فرم درجهٔ دو (معرفی توابع گروه `apply()` و رسم یک تابع سه‌بعدی)"
author: "رامین مجاب"
output: md_document
---

**(صفحهٔ ۲۴۲ کتاب)**

در این مثال، یک فرم درجهٔ دو را در یک فضای سه‌بعدی رسم خواهیم کرد.  لازم است از تابع `outer()` برای محاسبهٔ ماتریسی که سطح نمودار سه‌بعدی را نشان می‌دهد، استفاده کنیم. یکی از ورودی‌های این تابع، تابعی است که با آن به‌ازای ترکیبات `x` و `y`، مقدار `z` (یعنی ارتفاع) محاسبه می‌شود. این تابع در این مثال، فرم درجهٔ دو است. البته،  ورودی این تابع باید به‌صورت بردار باشد. پیش از توضیحات بیشتر، کد این تابع را ملاحظه کنید:
```{r}
degree2 <- function(x, y, A) {
  sapply(1:length(x), function(i) {
    m <- matrix(data = c(x[i], y[i]), nrow = 1) 
    m %*% A %*% t(m)
  })
}
```
ورودی‌های `x` و `y`، بردار هستند. ماتریس `A` یک ورودی اختیاری است و ماتریس ضرایب در فرم درجهٔ دو را مشخص می‌کند. لازم است  به‌ازای هرکدام از درایه‌های `x` و `y`، ضرب ماتریسی فرم درجهٔ دو را انجام دهیم و نتیجه را به‌صورت بردار بازگردانیم.
 بقیهٔ محاسبات موردنیاز توسط تابع `outer()` انجام می‌گیرد.

می‌توانیم از حلقهٔ `for`، که پیش‌تر در [مثال ۲-۳](matrix_book_fa_example2.3) معرفی شد، استفاده کنیم. بااین‌حال، به‌دلیل «سادگی» و «کارایی»، معمولاً در **R** به‌جای حلقهٔ `for`، از یکی از توابع `apply()`، `lapply()`، یا `sapply()` (و چند تابع مشابه) استفاده می‌شود. البته، هرکدام از این توابع ویژگی مخصوص به خود را دارند؛ مثلاً در مثال فوق، از `sapply()` استفاده شده است. این تابع عملیات‌هایی که در تابع درونی‌اش تعریف می‌شود، بر اعضای یک لیست انجام می‌دهد و اگر امکان‌پذیر باشد، خروجی را به‌صورت بردار یا ماتریس بازمی‌گرداند. در کد زیر و با استفاده از  تابعی که نوشتیم، مقادیر موردنیاز را تولید می‌کنیم:
```{r}
n <- 20
x <- y <- seq(-1, 1, length.out = n)
x_mat <- y_mat <- matrix(nrow = n, ncol = n)
for (i in 1:n) {
  x_mat[i, ] <- x
  y_mat[, i] <- y
}
z_mat <- outer(x, y, degree2,
  A = matrix(c(1, 0, 0, -1), nrow = 2)
)
```
(نسبت به کد در کتاب و با هدف نمایش بهتر، پارامتر `n` تغییر کرده است).

در اینجا نیز همانند [مثال ۷-۱](matrix_book_fa_example7.1)، اساس رسم نمودار بر محاسبهٔ نقاطی از نمودار اصلی است. تراکم این نقاط را می‌توانیم با پارامتر `n` تغییر دهیم. 

برای رسم نمودار، می‌توان از تابع `persp()` در بستهٔ پایه‌ای `graphics` استفاده کرد. بااین‌حال، بستهٔ نرم‌افزاری `plot3D` <span dir="ltr">[@R-plot3D]</span> ابزارهای قدرتمندتری در اختیار ما قرار می‌دهد و بنابراین، از آن  استفاده می‌کنیم. کد زیر را ببینید:

```{r fig_quadratic_form, fig.align='center', fig.cap="", fig.width=3, fig.height=3,echo=-1}
par <- par(mar = c(2, 2, 2, 2) + 0.1)
plot3D::surf3D(x_mat, y_mat, z_mat,
  colkey = FALSE, bty = "b2",
  col = gray(seq(0.8, 0, length.out = 100))
)
```

برای یافتن نحوهٔ کارکرد ورودی‌های تابع، به توضیحات آن رجوع کنید. به یاد  بسپارید که برای رسم نمودار سه‌بعدی، **R** دارای بسته‌های با قابلیت تعامل بیشتر نیز است؛ به‌طوری‌که به‌عنوان مثال، می‌توانید نمودارها را به‌صورت پویا بچرخانید و از زوایای مختلف بررسی کنید. یکی از این بسته‌ها `rgl` <span dir="ltr">[@R-rgl]</span>  است. پس از نصب این بسته، می‌توانید با اجرای کد زیر، این نمودار را مشاهده کنید:
```{r, eval=FALSE}
rgl::persp3d(x_mat, y_mat, z_mat,
  col = grey(seq(1, 0, length = 20))
)
```


